"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[421],{3905:function(e,t,n){n.d(t,{Zo:function(){return s},kt:function(){return m}});var i=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=i.createContext({}),d=function(e){var t=i.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},s=function(e){var t=d(e.components);return i.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},u=i.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,c=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),u=d(n),m=r,h=u["".concat(c,".").concat(m)]||u[m]||p[m]||a;return n?i.createElement(h,o(o({ref:t},s),{},{components:n})):i.createElement(h,o({ref:t},s))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,o=new Array(a);o[0]=u;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var d=2;d<a;d++)o[d]=n[d];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}u.displayName="MDXCreateElement"},2927:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return c},metadata:function(){return d},toc:function(){return s},default:function(){return u}});var i=n(7462),r=n(3366),a=(n(7294),n(3905)),o=["components"],l={sidebar_position:15},c="Manual integration with the Identity Service",d={unversionedId:"integrating-with-identity-service",id:"integrating-with-identity-service",isDocsHomePage:!1,title:"Manual integration with the Identity Service",description:"This is internal documentation. This document can be used only if it was recommended by the Support Team.",source:"@site/docs/integrating-with-identity-service.md",sourceDirName:".",slug:"/integrating-with-identity-service",permalink:"/xl-deploy-kubernetes-helm-chart/docs/integrating-with-identity-service",tags:[],version:"current",sidebarPosition:15,frontMatter:{sidebar_position:15},sidebar:"tutorialSidebar",previous:{title:"Make custom configuration for the Deploy",permalink:"/xl-deploy-kubernetes-helm-chart/docs/make-custom-configuration"},next:{title:"Deploy Installation on a Air-gapped K8S Cluster",permalink:"/xl-deploy-kubernetes-helm-chart/docs/air-gapped-installation"}},s=[{value:"Prerequisites",id:"prerequisites",children:[],level:2},{value:"1. Adding the Deploy client",id:"1-adding-the-deploy-client",children:[],level:2},{value:"2. Configuring Deploy",id:"2-configuring-deploy",children:[],level:2},{value:"3. Deploy XLD",id:"3-deploy-xld",children:[],level:2}],p={toc:s};function u(e){var t=e.components,n=(0,r.Z)(e,o);return(0,a.kt)("wrapper",(0,i.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"manual-integration-with-the-identity-service"},"Manual integration with the Identity Service"),(0,a.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"This is internal documentation. This document can be used only if it was recommended by the Support Team."))),(0,a.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"There is an account in the platform to connect to the Deploy instance (",(0,a.kt)("a",{parentName:"li",href:"https://demoaccount.staging.digital.ai"},"https://demoaccount.staging.digital.ai"),")"),(0,a.kt)("li",{parentName:"ul"},"There is an admin user (role ",(0,a.kt)("inlineCode",{parentName:"li"},"account-admin"),") in the account that can be used to configure the Deploy client (contact Kraken team)")),(0,a.kt)("h2",{id:"1-adding-the-deploy-client"},"1. Adding the Deploy client"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Log into the Identity Service account you want to connect to Deploy using an admin user for that account"),(0,a.kt)("li",{parentName:"ol"},"Go to Admin > Clients > Add OIDC Client"),(0,a.kt)("li",{parentName:"ol"},"Give the client a name (e.g. deploy)"),(0,a.kt)("li",{parentName:"ol"},"Scroll down to \u201cValid Redirect URIs\u201d and add")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"<deploy url>/login/external-login\n")),(0,a.kt)("ol",{start:5},(0,a.kt)("li",{parentName:"ol"},"Save the client")),(0,a.kt)("h2",{id:"2-configuring-deploy"},"2. Configuring Deploy"),(0,a.kt)("p",null,"In CR file disable Keycloak and update OIDC properties:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'  oidc:\n    enabled: true\n    clientId: "<client_id>"\n    clientSecret: "<client secret>"\n    external: true\n    issuer: "https://identity.staging.digital.ai/auth/realms/demoaccount"\n    redirectUri: "<deploy url>/login/external-login"\n    postLogoutRedirectUri: "<deploy url>/login/external-login"\n    rolesClaimName: "realm_access.roles"\n    userNameClaimName: preferred_username\n    scopes: ["openid"]\n')),(0,a.kt)("p",null,"To find the client id and secret, edit the Deploy client created above, scroll down to the Credentials section, and copy the values from there."),(0,a.kt)("p",null,"issuer can be found in the Identity Service Client section, in OIDC config that can be downloaded from there."),(0,a.kt)("p",null,"To check rolesClaimName value, decode the ID token.\n",(0,a.kt)("a",{parentName:"p",href:"https://docs.xebialabs.com/v.22.2/deploy/concept/deploy-oidc-with-keycloak/#test-public-rest-apis"},"Here")," you can find how to fetch token.\nUse ",(0,a.kt)("a",{parentName:"p",href:"https://jwt.io/"},"jwt")," to decode ID token. Get the roles path from decoded value - this is rolesClaimName."),(0,a.kt)("h2",{id:"3-deploy-xld"},"3. Deploy XLD"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Deploy XLD and navigate to the Deploy site in the browser. Log in with ",(0,a.kt)("inlineCode",{parentName:"li"},"admin")," user and add the role(s) from the Identity Service user to XLD as a principal. For example, if you are using user with ",(0,a.kt)("inlineCode",{parentName:"li"},"account-admin")," role, this role should be added as principal. "),(0,a.kt)("li",{parentName:"ol"},"Go to Global permissions in XLD and give needed permissions. For admin it will be ",(0,a.kt)("inlineCode",{parentName:"li"},"admin")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"login")," permissions."),(0,a.kt)("li",{parentName:"ol"},"Log in to the XLD with user from the Identity Service.")))}u.isMDXComponent=!0}}]);