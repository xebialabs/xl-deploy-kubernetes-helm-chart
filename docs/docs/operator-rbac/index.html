<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<title data-react-helmet="true">RBAC rules for the Deploy installation | Deploy Kubernetes Helm Chart</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://xebialabs.github.io/xl-deploy-kubernetes-helm-chart/docs/operator-rbac"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="RBAC rules for the Deploy installation | Deploy Kubernetes Helm Chart"><meta data-react-helmet="true" name="description" content="This is internal documentation. This document can be used only if it was recommended by the Support Team."><meta data-react-helmet="true" property="og:description" content="This is internal documentation. This document can be used only if it was recommended by the Support Team."><link data-react-helmet="true" rel="shortcut icon" href="/xl-deploy-kubernetes-helm-chart/img/digital_ai_deploy.svg"><link data-react-helmet="true" rel="canonical" href="https://xebialabs.github.io/xl-deploy-kubernetes-helm-chart/docs/operator-rbac"><link data-react-helmet="true" rel="alternate" href="https://xebialabs.github.io/xl-deploy-kubernetes-helm-chart/docs/operator-rbac" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://xebialabs.github.io/xl-deploy-kubernetes-helm-chart/docs/operator-rbac" hreflang="x-default"><link rel="stylesheet" href="/xl-deploy-kubernetes-helm-chart/assets/css/styles.22a8eaea.css">
<link rel="preload" href="/xl-deploy-kubernetes-helm-chart/assets/js/runtime~main.2f255115.js" as="script">
<link rel="preload" href="/xl-deploy-kubernetes-helm-chart/assets/js/main.5c4f4b77.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/xl-deploy-kubernetes-helm-chart/"><div class="navbar__logo"><img src="/xl-deploy-kubernetes-helm-chart/img/digital_ai_deploy.svg" alt="Deploy Kubernetes Helm Chart Digital.ai" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/xl-deploy-kubernetes-helm-chart/img/digital_ai_deploy.svg" alt="Deploy Kubernetes Helm Chart Digital.ai" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Deploy Kubernetes Helm Chart</b></a><a class="navbar__item navbar__link navbar__link--active" href="/xl-deploy-kubernetes-helm-chart/docs/intro">Tutorial</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/xebialabs/xl-deploy-kubernetes-helm-chart" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ðŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ðŸŒž</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-deploy-kubernetes-helm-chart/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-deploy-kubernetes-helm-chart/docs/prerequisites">Prerequisites</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-deploy-kubernetes-helm-chart/docs/chart">Chart</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-deploy-kubernetes-helm-chart/docs/tested-configuration">Tested Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-deploy-kubernetes-helm-chart/docs/installing-storage-class">Installing Storage Class</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-deploy-kubernetes-helm-chart/docs/installing-helm-chart">Installing Helm Chart</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-deploy-kubernetes-helm-chart/docs/upgrading-helm-chart">Upgrading Helm Chart</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-deploy-kubernetes-helm-chart/docs/uninstalling-helm-chart">Uninstalling Helm Chart</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-deploy-kubernetes-helm-chart/docs/access-dashboard">Access Dashboard</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-deploy-kubernetes-helm-chart/docs/parameters">Parameters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-deploy-kubernetes-helm-chart/docs/development">Development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-deploy-kubernetes-helm-chart/docs/useful-links">Useful links</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-deploy-kubernetes-helm-chart/docs/building-operator-image">Building the operator image from helm chart</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-deploy-kubernetes-helm-chart/docs/make-custom-configuration">Make custom configuration for the Deploy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-deploy-kubernetes-helm-chart/docs/integrating-with-identity-service">Manual integration with the Identity Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-deploy-kubernetes-helm-chart/docs/air-gapped-installation">Deploy Installation on a Air-gapped K8S Cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/xl-deploy-kubernetes-helm-chart/docs/operator-rbac">RBAC rules for the Deploy installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xl-deploy-kubernetes-helm-chart/docs/migration-deploy-from-on-prem-to-k8s">Migrate an existing Digital.ai Deploy installation to Kubernetes (v23.3 and v24.1)</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>RBAC rules for the Deploy installation</h1></header><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>This is internal documentation. This document can be used only if it was recommended by the Support Team.</p></div></div><p>In Kubernetes, an operator is a piece of software that manages a specific application or service on behalf of its users.
Operators typically use Kubernetes API calls to create, update, and delete resources that are associated with the application or service they manage.
In order to perform these operations, the operator needs to have the appropriate permissions in Kubernetes.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="requirements">Requirements<a aria-hidden="true" class="hash-link" href="#requirements" title="Direct link to heading">â€‹</a></h2><ul><li>Running k8s cluster</li><li><code>kubectl</code> connected to the cluster</li><li><code>xl-cli</code> installed - version 23.3.x</li><li>Deploy operator - version 23.3.x</li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="rbac-rules-for-the-xl-kube">RBAC rules for the <code>xl kube</code><a aria-hidden="true" class="hash-link" href="#rbac-rules-for-the-xl-kube" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_31ik" id="installation-and-upgrade">Installation and Upgrade<a aria-hidden="true" class="hash-link" href="#installation-and-upgrade" title="Direct link to heading">â€‹</a></h3><p>During <code>xl kube install</code> process is doing apply of the following resource kinds:</p><ul><li>Service</li><li>Secret</li><li>CustomResourceDefinition</li><li>Deployment</li><li>Role</li><li>RoleBinding</li><li>DigitalaiDeploy.</li></ul><p>Additionally, if there is selected creation of namespace, it is needed create for:</p><ul><li>Namespace.</li></ul><p>If there is selected nginx controller installation xl-cli needs to create:</p><ul><li>ClusterRole</li><li>ClusterRoleBinding.</li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="clean">Clean<a aria-hidden="true" class="hash-link" href="#clean" title="Direct link to heading">â€‹</a></h3><p>To run <code>xl kube clean</code> the process needs all the resources that used with <code>xl kube install</code>,
together with resources that are defined for operator with:</p><ul><li>Role: xld-operator-manager</li><li>Cluster Role: xld-operator-manager.</li></ul><p>Note: Clean is not deleting the namespace, so it does not need permissions on the namespace.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="upgrade">Upgrade<a aria-hidden="true" class="hash-link" href="#upgrade" title="Direct link to heading">â€‹</a></h3><p>To run <code>xl kube upgrade</code> the process needs all the resources that used with </p><ul><li><code>xl kube install</code></li><li><code>xl kube clean</code></li><li>and all verbs on the Job resource.</li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="rbac-rules-for-the-deploy-installation-1">RBAC rules for the Deploy installation<a aria-hidden="true" class="hash-link" href="#rbac-rules-for-the-deploy-installation-1" title="Direct link to heading">â€‹</a></h2><p>The operator needs following roles to be able to manage resources for the Deploy:</p><ul><li><p>Roles:</p><ul><li>xld-operator-leader-election</li><li>xld-operator-proxy</li><li>xld-operator-manager</li></ul></li><li><p>Cluster role:</p><ul><li>xld-operator-manager (the name depends on the custom namespace)</li></ul></li></ul><p>All roles have role binding to the default service account that is located in the namespace where the operator will be installed.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="role-xld-operator-leader-election">Role: xld-operator-leader-election<a aria-hidden="true" class="hash-link" href="#role-xld-operator-leader-election" title="Direct link to heading">â€‹</a></h3><p>Leader election role is used by operator for internal management of the operator&#x27;s resources, it is using following resources:</p><ul><li>configmaps</li><li>events</li><li>leases.</li></ul><p>This role is used always by the operator.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="role-xld-operator-proxy">Role: xld-operator-proxy<a aria-hidden="true" class="hash-link" href="#role-xld-operator-proxy" title="Direct link to heading">â€‹</a></h3><p>The role is for operator to determine whether a user or service account has the necessary permissions to perform a particular operation,
and to verify that a user or service account is authenticated and authorized to make API requests.</p><p>Operator proxy role is using following resources:</p><ul><li>tokenreviews</li><li>subjectaccessreviews.</li></ul><p>This role is used always by the operator.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="role-xld-operator-manager">Role: xld-operator-manager<a aria-hidden="true" class="hash-link" href="#role-xld-operator-manager" title="Direct link to heading">â€‹</a></h3><p>To manage all the resources that are needed for the Deploy we have this role. Role is giving permission to operator to manage all the resources.</p><p>It is used for managing following resources:</p><ul><li>events</li><li>configmaps</li><li>persistentvolumeclaims</li><li>secrets</li><li>serviceaccounts</li><li>services</li><li>deployments</li><li>statefulsets</li><li>daemonsets</li><li>ingresses</li><li>poddisruptionbudgets</li><li>rolebindings</li><li>roles</li><li>digitalaideploys</li><li>digitalaideploys/status</li><li>digitalaideploys/finalizers.</li></ul><p>This role is used always by the operator.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="cluster-role-xld-operator-manager">Cluster Role: xld-operator-manager<a aria-hidden="true" class="hash-link" href="#cluster-role-xld-operator-manager" title="Direct link to heading">â€‹</a></h3><p>This is the only cluster role that is needed by the operator, but it is only used when ingress controller is managed by the operator.
If ingress controller is not managed by the operator (nginx and haproxy ingresses are disabled), this role is not needed.</p><p>It is used for managing following resources:</p><ul><li>events</li><li>ingressclasses</li><li>clusterrolebindings</li><li>clusterroles.</li></ul><p>For the openshift variant of the operator following additional resources are managed:</p><ul><li>poddisruptionbudgets</li><li>securitycontextconstraints</li><li>and all resources in the route.openshift.io API group.</li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/xl-deploy-kubernetes-helm-chart/docs/air-gapped-installation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Deploy Installation on a Air-gapped K8S Cluster</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/xl-deploy-kubernetes-helm-chart/docs/migration-deploy-from-on-prem-to-k8s"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Migrate an existing Digital.ai Deploy installation to Kubernetes (v23.3 and v24.1)<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#requirements" class="table-of-contents__link toc-highlight">Requirements</a></li><li><a href="#rbac-rules-for-the-xl-kube" class="table-of-contents__link toc-highlight">RBAC rules for the <code>xl kube</code></a><ul><li><a href="#installation-and-upgrade" class="table-of-contents__link toc-highlight">Installation and Upgrade</a></li><li><a href="#clean" class="table-of-contents__link toc-highlight">Clean</a></li><li><a href="#upgrade" class="table-of-contents__link toc-highlight">Upgrade</a></li></ul></li><li><a href="#rbac-rules-for-the-deploy-installation-1" class="table-of-contents__link toc-highlight">RBAC rules for the Deploy installation</a><ul><li><a href="#role-xld-operator-leader-election" class="table-of-contents__link toc-highlight">Role: xld-operator-leader-election</a></li><li><a href="#role-xld-operator-proxy" class="table-of-contents__link toc-highlight">Role: xld-operator-proxy</a></li><li><a href="#role-xld-operator-manager" class="table-of-contents__link toc-highlight">Role: xld-operator-manager</a></li><li><a href="#cluster-role-xld-operator-manager" class="table-of-contents__link toc-highlight">Cluster Role: xld-operator-manager</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/xl-deploy-kubernetes-helm-chart/docs/intro">Tutorial</a></li><li class="footer__item"><a href="https://github.com/xebialabs/xl-deploy-kubernetes-helm-chart" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2024 Deploy Kubernetes Helm Chart Digital.ai</div></div></div></footer></div>
<script src="/xl-deploy-kubernetes-helm-chart/assets/js/runtime~main.2f255115.js"></script>
<script src="/xl-deploy-kubernetes-helm-chart/assets/js/main.5c4f4b77.js"></script>
</body>
</html>